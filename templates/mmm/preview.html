{% extends "layouts/default.html" %}
{% block main %}
  <h1 class="mb-6 text-3xl">Preview Your Data</h1>
  <h2 class="mb-6 text-2xl">
    {{ csv_file.file_name }}
  </h2>
  <p class="mb-6 text-lg">
    Here is a preview of your data. You can download the full file <a href="{% url 'mmm:serve_csv' csv_file.id %}">here</a>.
  </p>
  <canvas id="myChart"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('myChart');
    const data = {{ data|safe }};
    const labels = {{ labels|safe }};

    // Log data for debugging
    console.log("Data:", data.slice(0, 5));
    console.log("Labels:", labels.slice(0, 5));

    new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'CSV Data (€)',
            data: data,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value, index, values) {
                  return '€' + value.toLocaleString();
                }
              }
            }
          },
          plugins: {
            zoom: {
              pan: {
                enabled: true,
                mode: 'xy',
              },
              zoom: {
                wheel: {
                  enabled: true,
                },
                pinch: {
                  enabled: true
                },
                mode: 'xy',
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return '€' + context.parsed.y.toLocaleString();
                }
              }
            }
          }
        }
      });
    </script>
{% endblock main %}